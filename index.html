<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Shop</title>
    <style>
        /* Base Styles - No External Fonts */
        body { font-family: system-ui, sans-serif; margin: 0; background: #f4f7f6; color: #333; }
        nav { background: #fff; padding: 1rem; border-bottom: 1px solid #ddd; position: sticky; top: 0; z-index: 10; display: flex; justify-content: space-between; align-items: center; }
        .container { max-width: 1000px; margin: auto; padding: 1rem; }
        
        /* Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; }
        .card { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px #0001; position: relative; display: flex; flex-direction: column; }
        .card img { width: 100%; aspect-ratio: 1; object-fit: cover; background: #eee; cursor: pointer; }
        .card-body { padding: 10px; flex-grow: 1; display: flex; flex-direction: column; }
        .price { color: #2563eb; font-weight: bold; font-size: 1.1rem; margin: 5px 0; }
        
        /* Buttons */
        button { cursor: pointer; border: none; border-radius: 4px; padding: 8px 12px; font-weight: bold; transition: 0.2s; }
        .btn-add { background: #333; color: #fff; width: 100%; margin-top: auto; }
        .btn-add:hover { background: #000; }
        .btn-details { background: #e2e8f0; color: #475569; width: 100%; margin-top: 8px; font-size: 0.8rem; }
        .btn-details:hover { background: #cbd5e1; }
        .btn-fav { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.8); padding: 5px; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; z-index: 2; }
        .fav-active { color: red; }

        /* Search */
        #search { padding: 8px; border: 1px solid #ddd; border-radius: 20px; width: 200px; outline: none; }
        #search:focus { border-color: #2563eb; }

        /* Side Panels & Modals */
        .panel { position: fixed; right: 0; top: 0; bottom: 0; width: 300px; background: #fff; box-shadow: -2px 0 10px #0002; transform: translateX(100%); transition: 0.3s; z-index: 20; padding: 20px; display: flex; flex-direction: column; }
        .panel.open { transform: translateX(0); }
        
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 30; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #fff; padding: 25px; border-radius: 12px; max-width: 400px; width: 100%; position: relative; }
        
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; z-index: 15; }
        .item-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .item-row img { width: 40px; height: 40px; border-radius: 4px; object-fit: cover; }
    </style>
</head>
<body>

    <nav>
        <b style="font-size: 1.2rem;">MYSHOP</b>
        <input type="text" id="search" placeholder="Search..." oninput="doSearch()">
        <div>
            <button onclick="openPanel('favPanel')" title="Wishlist">‚ù§Ô∏è <span id="fCount">0</span></button>
            <button onclick="openPanel('cartPanel')" title="Cart">üõí <span id="cCount">0</span></button>
        </div>
    </nav>

    <div class="container">
        <div id="loading">Loading products...</div>
        <div id="grid" class="grid"></div>
    </div>

    <!-- Details Modal -->
    <div id="detailsModal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <button style="position:absolute; right:15px; top:15px; background:none; font-size:1.2rem;" onclick="document.getElementById('detailsModal').style.display='none'">‚úï</button>
            <img id="m-img" src="" style="width:100%; border-radius:8px; aspect-ratio:1; object-fit:cover; margin-bottom:15px;">
            <h2 id="m-title" style="margin:0 0 5px 0;"></h2>
            <div id="m-price" class="price" style="font-size:1.4rem;"></div>
            <p id="m-desc" style="color:#666; line-height:1.5; font-size:0.9rem; margin:15px 0;"></p>
            <button class="btn-add" id="m-add-btn">Add to Cart</button>
        </div>
    </div>

    <div id="overlay" class="overlay" onclick="closePanels()"></div>

    <!-- Cart Panel -->
    <div id="cartPanel" class="panel">
        <h3>Your Cart</h3>
        <div id="cartList" style="flex-grow: 1; overflow-y: auto;"></div>
        <hr>
        <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom: 10px;">
            <span>Total:</span><span id="total">‚Çπ0</span>
        </div>
        <button class="btn-add" style="background:#16a34a" onclick="checkout()">WhatsApp Checkout</button>
        <button class="btn-add" onclick="closePanels()" style="background:#64748b">Close</button>
    </div>

    <!-- Favorites Panel -->
    <div id="favPanel" class="panel">
        <h3>Wishlist</h3>
        <div id="favList" style="flex-grow: 1; overflow-y: auto;"></div>
        <button class="btn-add" onclick="closePanels()" style="background:#64748b">Close</button>
    </div>

    <script>
        // CONFIG
        const CONFIG = {
            USER: "iamsourabhalder",
            REPO: "shop",
            WA: "918513001304"
        };

        let products = [];
        let cart = JSON.parse(localStorage.getItem('scart')) || [];
        let favs = JSON.parse(localStorage.getItem('sfav')) || [];

        // Load Data
        async function load() {
            const url = `https://raw.githubusercontent.com/${CONFIG.USER}/${CONFIG.REPO}/main/data.json?t=${Date.now()}`;
            try {
                const res = await fetch(url);
                products = await res.json();
                document.getElementById('loading').style.display = 'none';
                render(products);
                updateUI();
            } catch (e) {
                document.getElementById('loading').innerText = "Error loading data.";
            }
        }

        function render(list) {
            const g = document.getElementById('grid');
            g.innerHTML = list.map(p => `
                <div class="card">
                    <button class="btn-fav ${favs.includes(p.id)?'fav-active':''}" onclick="toggleFav('${p.id}')">‚ù§</button>
                    <img src="${p.image || ''}" onclick="showDetails('${p.id}')">
                    <div class="card-body">
                        <div style="font-weight:bold; font-size:0.9rem;">${p.title}</div>
                        <div class="price">‚Çπ${p.price}</div>
                        <button class="btn-add" onclick="addCart('${p.id}')">Add to Cart</button>
                        <button class="btn-details" onclick="showDetails('${p.id}')">View Details</button>
                    </div>
                </div>
            `).join('');
        }

        function showDetails(id) {
            const p = products.find(x => x.id === id);
            if(!p) return;
            document.getElementById('m-img').src = p.image || '';
            document.getElementById('m-title').innerText = p.title;
            document.getElementById('m-price').innerText = "‚Çπ" + p.price;
            document.getElementById('m-desc').innerText = p.notes || "No description available for this product.";
            document.getElementById('m-add-btn').onclick = () => {
                addCart(p.id);
                document.getElementById('detailsModal').style.display = 'none';
            };
            document.getElementById('detailsModal').style.display = 'flex';
        }

        function closeModal(e) {
            if(e.target.id === 'detailsModal') e.target.style.display = 'none';
        }

        function doSearch() {
            const q = document.getElementById('search').value.toLowerCase();
            render(products.filter(p => p.title.toLowerCase().includes(q)));
        }

        function addCart(id) {
            const item = cart.find(c => c.id === id);
            if(item) item.qty++;
            else cart.push({...products.find(p => p.id === id), qty: 1});
            save();
        }

        function toggleFav(id) {
            if(favs.includes(id)) favs = favs.filter(f => f !== id);
            else favs.push(id);
            save();
            render(products); 
        }

        function updateUI() {
            localStorage.setItem('scart', JSON.stringify(cart));
            localStorage.setItem('sfav', JSON.stringify(favs));
            
            document.getElementById('cCount').innerText = cart.length;
            document.getElementById('fCount').innerText = favs.length;

            let sum = 0;
            document.getElementById('cartList').innerHTML = cart.map(i => {
                sum += i.price * i.qty;
                return `<div class="item-row">
                    <img src="${i.image}">
                    <div style="flex:1; font-size:0.85rem;"><b>${i.title}</b><br>‚Çπ${i.price} x ${i.qty}</div>
                    <button onclick="changeQty('${i.id}', -1)" style="padding:2px 8px">-</button>
                    <button onclick="changeQty('${i.id}', 1)" style="padding:2px 8px">+</button>
                </div>`;
            }).join('') || '<p style="color:#999; text-align:center;">Empty</p>';
            document.getElementById('total').innerText = "‚Çπ" + sum;

            document.getElementById('favList').innerHTML = favs.map(id => {
                const p = products.find(x => x.id === id);
                return p ? `<div class="item-row"><img src="${p.image}"> <span style="font-size:0.85rem;">${p.title}</span><button onclick="toggleFav('${p.id}')" style="background:none; color:red; margin-left:auto;">‚úï</button></div>` : '';
            }).join('') || '<p style="color:#999; text-align:center;">Empty</p>';
        }

        function changeQty(id, n) {
            const i = cart.find(c => c.id === id);
            if(!i) return;
            i.qty += n;
            if(i.qty < 1) cart = cart.filter(c => c.id !== id);
            save();
        }

        function save() { updateUI(); }

        function openPanel(id) {
            document.getElementById(id).classList.add('open');
            document.getElementById('overlay').style.display = 'block';
        }

        function closePanels() {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('open'));
            document.getElementById('overlay').style.display = 'none';
        }

        function checkout() {
            if(cart.length === 0) return alert("Cart is empty");
            let msg = "*Order Details:*\n" + cart.map(i => `- ${i.title} (x${i.qty}) = ‚Çπ${i.price * i.qty}`).join('\n');
            msg += "\n\n*Total: " + document.getElementById('total').innerText + "*";
            window.open(`https://wa.me/${CONFIG.WA}?text=${encodeURIComponent(msg)}`);
        }

        window.onload = load;
    </script>
</body>
</html>

